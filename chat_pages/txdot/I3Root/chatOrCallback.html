<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=7" />
        <meta http-equiv="Pragma" content="no-cache">
        <meta http-equiv="Expires" content="-1">
        <meta http-equiv="cache-control" content="no-cache" />
        <title>TxTag Chat</title>
        <link rel="Stylesheet" type="text/css" href="page.css" media="all" />
        <link rel="Stylesheet" type="text/css" href="webchat.css" media="all" />
        <script src="js/Bootloader.js" type="text/javascript"></script> 
    </head>
    <body onload="checkVisible()">
        <div id="iwc-web-chat-container">
            <noscript>
                <div class="iwc-web-chat">
                    <div class="iwc-login-container">
                        <h1 class="iwc-page-header">Interaction Web Tools</h1>
                        <div>
                            <div class="iwc-error">
                                <img src="img/error.png" alt="Error" />
                                <span>Javascript is required to view this site.</span>
                            </div>
                        </div>
                    </div>
                </div>
            </noscript>
        </div>
        <script type="text/javascript">
            var callback = function()
            {
				var customInfo = ININ.Web.Common.Utilities.getQueryStringValue("customInfo");
				//alert("customInfo: "+customInfo);
				var params = {
                                 "currentUriFragment" : ININ.Web.Chat.UI.ConfigConversions.convertICServerCountToCurrentUriFragment(ININ.Web.Chat.Config.ICServerCount),
                                 "uriFragments" : ININ.Web.Chat.UI.ConfigConversions.convertICServerCountToUriFragments(ININ.Web.Chat.Config.ICServerCount),
                                 "pageMode" : ININ.Web.Chat.UI.ConfigConversions.convertInteractionTypesToPageMode(ININ.Web.Chat.Config.InteractionTypes),
                                 "chatTarget" : ININ.Web.Chat.Config.ChatTarget,
                                 "chatTargetType" : ININ.Web.Chat.Config.ChatTargetType,
                                 "callbackTarget" : ININ.Web.Chat.Config.CallbackTarget,
                                 "callbackTargetType" : ININ.Web.Chat.Config.CallbackTargetType,
                                 "defaultLanguageCode" : ININ.Web.Chat.Config.DefaultLanguageCode,
                                 "useHttps" : ININ.Web.Chat.Config.UseEncryption,
								 "customInfo" : customInfo
                             };
                ININ.Web.Chat.UI.Page.load(params);
            };

            var intervalID = null;
            function checkVisible() {
                if (window.outerWidth !== 0) {
                    // Either visible from the start, or was initially invisible and then the interval fired
                    if (null != intervalID) {
                        // If it was that the interval fired, clear the interval
                        window.clearInterval(intervalID);
                        intervalID = null;
                    }
                    Bootloader.load(callback);
                } else if (null == intervalID) {
                    // Initially invisible
                    intervalID = window.setInterval(checkVisible, 500);
                }
            }
        </script>
    </body>
</html>
